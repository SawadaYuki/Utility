#!/bin/sh

command=$*
searchStr="realSec"
var="0123456789.\n"
result_file=tmpEvalu_[$command].txt
result_file2=TMP2.txt
touch "$result_file"
touch TMP.txt



echo "--search word--"
echo $searchStr
echo "command ="  $command

sum=1

cat /dev/null > $result_file
`cp -r ./openmpi-sessions-sawada@witch.is.utsunomiya-u.ac.jp_0 /tmp/ `
`scp -pr ./openmpi-sessions-sawada@witch.is.utsunomiya-u.ac.jp_0/ aegis:/tmp/ `

for i in 1 2 3 4 5 6 7 8 9 10
do 
    echo "$i : exec commad"
    `$command`
    file=`find /tmp/dmtcp-sawada@deep.is.utsunomiya-u.ac.jp/ -name "*_coordinator"`
    file2=
    echo "--file:coordinator--"
    echo $file

    echo "--execution_time_line-- "
    execution_time_line=`cat $file | grep $searchStr` 
    echo $execution_time_line 
    echo $execution_time_line >> $result_file2

    echo "--extract execution_time--"
    execution_time=`echo $execution_time_line | tr -cd $var`
    echo $execution_time >> TMP.txt
    #echo $((`expr $sum`+`expr $execution_time`))
    echo $execution_time >> $result_file
    
    `mv $file ./log/nomal/`
    #`mv $file ./log/changeDomain/ `
    #`mv /tmp/dmtcp-sawada@deep.is.utsunomiya-u.ac.jp/*  ./log/changeDomain/temp`
    `rm  /tmp/dmtcp-sawada@deep.is.utsunomiya-u.ac.jp/* `
    `cp -r ./openmpi-sessions-sawada@witch.is.utsunomiya-u.ac.jp_0 /tmp/ `
    `scp -pr ./openmpi-sessions-sawada@witch.is.utsunomiya-u.ac.jp_0/ aegis:/tmp/ `
    `sleep 60`

done

echo "--print: $result_file--"

#cat $result_file

while read line; do
    echo $line
done < $result_file

`mv TMP.txt ./log/nomal/20Mbps `
`mv "$result_file2" ./log/nomal/20Mbps `

# echo "script num :$# "
# programIndex=$#

# echo $($programIndex)
# echo $8


